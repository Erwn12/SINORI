<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbyKHFMNxbpjG7STgOOo5vRlidxb1Gf7w6FN6Tt5zzuzegUi1IEVug2cU6GXLYVNfcgxvQ/exec";

  async function fetchData() {
    try {
      const response = await fetch(`${API_URL}?action=read`);
      if (!response.ok) throw new Error("Failed to fetch data");
      const data = await response.json();
      renderTable(data);
    } catch (error) {
      console.error("Error fetching data:", error);
      alert("Terjadi kesalahan saat mengambil data.");
    }
  }

  document.getElementById("data-form").addEventListener("submit", async (e) => {
    e.preventDefault();
    console.log("Form submitted");

    const id = document.getElementById("id").value;
    const nomorBerkas = document.getElementById("nomorBerkas").value;
    const alamatPenerima = document.getElementById("alamatPenerima").value;
    const tanggal = document.getElementById("tanggal").value;
    const user = "admin";

    const method = id ? "update" : "create";
    const body = { id, nomorBerkas, alamatPenerima, tanggal, user };

    console.log("Sending request to backend:", body);

    try {
      const response = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action: method, ...body }),
      });

      console.log("Response received:", response);

      if (response.ok) {
        closeModal();
        fetchData();
      } else {
        console.error("Error:", response.statusText);
        alert("Terjadi kesalahan saat menyimpan data.");
      }
    } catch (error) {
      console.error("Error:", error);
      alert("Terjadi kesalahan saat menghubungi server.");
    }
  });

  async function deleteData(id) {
    console.log("Deleting data with ID:", id);

    try {
      const response = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action: "delete", id }),
      });

      console.log("Response received:", response);

      if (response.ok) {
        fetchData();
      } else {
        console.error("Error:", response.statusText);
        alert("Terjadi kesalahan saat menghapus data.");
      }
    } catch (error) {
      console.error("Error:", error);
      alert("Terjadi kesalahan saat menghubungi server.");
    }
  }

  fetchData();
</script>
